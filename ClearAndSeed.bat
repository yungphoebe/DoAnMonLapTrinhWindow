@echo off
chcp 65001 > nul
color 0C
echo.
echo ??????????????????????????????????????????????????????????
echo ?     XÓA VÀ SEED L?I D? LI?U - T? ??NG               ?
echo ??????????????????????????????????????????????????????????
echo.
echo ??  C?NH BÁO: Script này s?:
echo    1. Xóa T?T C? d? li?u trong database
echo    2. Seed d? li?u m?u m?i (4 users, 6 projects, 20 tasks...)
echo.
set /p confirm="B?n có ch?c ch?n mu?n ti?p t?c? (Y/N): "

if /i "%confirm%" neq "Y" (
    echo.
    echo ? ?ã h?y!
    pause
    exit /b
)

cd /d "%~dp0"

echo.
echo [1/3] Chu?n b? môi tr??ng...

REM Copy appsettings.json
if not exist "appsettings.json" (
    if exist "TodoListApp.DAL\appsettings.json" (
        copy "TodoListApp.DAL\appsettings.json" "appsettings.json" > nul
        echo ? ?ã copy appsettings.json
    ) else (
        echo ? Không tìm th?y appsettings.json!
        pause
        exit /b 1
    )
) else (
    echo ? appsettings.json ?ã t?n t?i
)

echo.
echo [2/3] Build project...
dotnet build TodoListApp.DAL\TodoListApp.DAL.csproj --configuration Release -v quiet > nul 2>&1
if %errorlevel% neq 0 (
    echo ? Build th?t b?i!
    dotnet build TodoListApp.DAL\TodoListApp.DAL.csproj --configuration Release
    pause
    exit /b %errorlevel%
)
echo ? Build thành công

echo.
echo [3/3] Xóa và seed d? li?u...
echo.

REM T? ??ng ch?n option 3 và gõ 'yes'
echo 3> temp_input.txt
echo yes>> temp_input.txt

dotnet run --project TodoListApp.DAL\TodoListApp.DAL.csproj --configuration Release < temp_input.txt

del temp_input.txt > nul 2>&1

echo.
echo ???????????????????????????????????????????????????????
echo.
if %errorlevel% equ 0 (
    color 0A
    echo ? THÀNH CÔNG!
    echo.
    echo ?? D? li?u ?ã ???c seed vào database:
    echo    • 4 Users
    echo    • 6 Projects  
    echo    • 20 Tasks
    echo    • 8 Tags
    echo    • 5 Reminders
    echo    • 5 Focus Sessions
    echo.
    echo ?? B?n có th? ch?y ToDoList.GUI ?? test!
) else (
    color 0C
    echo ? CÓ L?I X?Y RA!
    echo.
    echo Vui lòng ki?m tra:
    echo 1. SQL Server ?ang ch?y
    echo 2. Database ToDoListApp ?ã t?o
    echo 3. Connection string trong appsettings.json ?úng
)
echo.
echo ???????????????????????????????????????????????????????
echo.
pause
